<app-loader [isLoading]="loading"></app-loader>
<div class="container-fluid main-section">
  <div class="modal-content">
    <form [formGroup]="formFiltro">
        <div class="container">
            <h4 class="title-menu centered-rounded-background">
                <a>
                    <img *ngIf="imgSubmenu !== undefined" class="img-crud" src="{{imgSubmenu.TipoIcono}}{{imgSubmenu.Icono}}" />
                </a>
                <a style="margin-left: 5px;">Realizar Venta</a>
            </h4>
        </div>
        <div class="row mt-3 justify-content-end"> <!-- Alineamos los elementos a la derecha -->
            <div class="col-md-3">
                <label for="busqueda"><i class="fa-solid fa-barcode"></i> Código de barras: </label>
                <div class="input-group">
                    <input type="text" formControlName="busquedaCodigoBarras" class="form-control" id="busquedaCodigoBarras" placeholder="Buscar por código de barras...">
                </div>
            </div>
            <div class="col-md-3">
                <label for="busquedaManual"><i class="fa-solid fa-magnifying-glass"></i> Busqueda Manual:</label>
                <div class="input-group">
                    <input type="text" formControlName="busquedaManual" class="form-control" id="busquedaManual" placeholder="Buscar manualmente...">
                    <div class="input-group-append">
                        <button type="button" class="btn btn-secondary" id="btnLimpiar">
                            <i class="fa-solid fa-eraser"></i>
                        </button>
                        <button type="button" class="btn btn-secondary" id="btnBorrarTodo">
                            Borrar Todo
                        </button>
                    </div>
                </div>
            </div>
            <div class="col-md-6 ml-auto align-self-end">
                <div class="text-right total-venta">
                    <h3 class="mb-0">Total Venta: S./ <span id="totalVenta">0.00</span></h3>
                </div>
            </div>                   
        </div>
    </form>
    

    <div class="row mt-3">
      <div class="col-md-9">
        <div class="registros" *ngIf="listaGrilla && listaGrilla.length > 0; else noData">
          <div class="table-responsive">
            <div class="scroll-table">
              <ng-container *ngIf="(listaGrilla | busqueda:Busqueda:'IdTipoCategoria':'Descripcion').length > 0; else noResults">
                <table class="table">
                  <thead class="thead-dark">
                    <tr>
                      <th scope="col">Nro</th>
                      <th scope="col">Código</th>
                      <th scope="col">Producto</th>
                      <th scope="col">Precio Unitario</th>
                      <th scope="col">Cantidad</th>
                      <th scope="col">Precio por cantidad</th>
                      <th scope="col">Acción</th>
                    </tr>
                  </thead>
                  <tbody class="tablaUser">
                    <tr *ngFor="let item of listaGrilla | busqueda:Busqueda:'IdTipoCategoria':'Descripcion'; let i = index">
                      <td scope="col">{{ item.IdTipoCategoria }}</td>
                      <td scope="col">111111</td>
                      <td scope="col">{{ item.Descripcion }}</td>
                      <td scope="col">1000</td>
                      <td scope="col">2</td>
                      <td scope="col">2000</td>
                      <td scope="col">
                        <button class="btn btn-danger" >
                          <i class="fa-solid fa-trash"></i>
                        </button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </ng-container>
              <ng-template #noResults>
                <div class="alert alert-info alert-custom-orange mt-4" role="alert" id="alerta">
                  No se encontraron resultados.
                </div>
              </ng-template>
            </div>
          </div>
        </div>
        <ng-template #noData>
          <div class="alert alert-info alert-custom-orange mt-4" role="alert" id="alerta">
            No hay datos disponibles.
          </div>
        </ng-template>
      </div>
      <div class="col-md-3" id="datosVenta">
        <div class="card shadow card-long">
          <h5 class="card-header py-1 bg-primary text-white text-center">
            Datos de Venta<span id="totalVentaRegistrar"></span>
          </h5>
          <div class="card-body p-2">
            <!-- SELECCIONAR TIPO DE DOCUMENTO -->
            <div class="form-group mb-2">
              <label class="col-form-label" for="selDocumentoVenta">
                <i class="fas fa-file-alt fs-6"></i>
                <span class="small"> Documento</span><span class="text-danger">*</span>
              </label>
              <select class="form-select form-select-sm" aria-label=".form-select-sm example" id="selDocumentoVenta" name="documento">
                <option value="0" selected disabled id="defaultOption">Seleccione Documento</option>
              </select>
              <span id="validate_categoria" class="text-danger small fst-italic" style="display:none">
                Debe Seleccione documento
              </span>
            </div>
            <!-- SELECCIONAR TIPO DE PAGO -->
            <div class="form-group mb-2">
              <label class="col-form-label" for="selCategoriaReg">
                <i class="fas fa-money-bill-alt fs-6"></i>
                <span class="small"> Forma de Pago</span><span class="text-danger">*</span>
              </label>
              <select class="form-select form-select-sm" aria-label=".form-select-sm example" id="selTipoPago">
                <option value="" selected disabled id="defaultOption">Seleccione Forma de Pago</option>
              </select>
            </div>
            <!-- SERIE Y NRO DE BOLETA -->
            <div class="form-group">
              <div class="row">
                <div class="col-md-8">
                  <label for="iptNroVenta">Nro Venta</label>
                  <input type="text" min="1" name="iptEfectivo" id="iptNroVenta" class="form-control form-control-sm" placeholder="Nro Venta" disabled>
                </div>
              </div>
            </div>
            <!-- INPUT DE EFECTIVO ENTREGADO -->
            <div class="form-group">
              <label for="iptEfectivoRecibido">Monto recibido</label>
              <input type="number" min="0" name="iptEfectivo" id="iptEfectivoRecibido" class="form-control form-control-sm" placeholder="Cantidad de efectivo recibida">
            </div>
            <!-- INPUT CHECK DE EFECTIVO EXACTO -->
            <div class="form-check">
              <input class="form-check-input" type="checkbox" value="" id="chkEfectivoExacto">
              <label class="form-check-label" for="chkEfectivoExacto">
                Monto Exacto
              </label>
            </div>
            <div class="form-group">
              <label for="iptagregarDescuento">Agregar Descuento</label>
              <input type="number" min="0" name="iptDescuento" id="iptagregarDescuento" class="form-control form-control-sm" placeholder="Agregar Descuento">
            </div>
            <div class="row">
                <div class="col-md-12 d-flex justify-content-between align-items-end">
                  <button type="button" class="btn btn-danger" id="btnGenerarVenta" style="margin-top: 10px;">
                    <i class="fa-solid fa-cart-shopping"></i>
                    Generar Venta
                  </button>
                  <button type="button" class="btn btn-primary" id="btnImprimir" (click)="openAgregar(content)">
                    <i class="fa-solid fa-print"></i>
                  </button>
                </div>
              </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- AgregarCategoriaModal -->
  <ng-template #content let-modal>
    <div class="modal-header">
      <a></a>
      <h4 class="modal-title">{{ tituloModal }}</h4>
    </div>
    <div class="modal-body">
      <form [formGroup]="formItemGrilla">
        <div class="form-row">
          <div class="form-group col-md-10">
            <div style="margin-bottom: 15px">
              <label for="descripcion">Descripción:</label>
            </div>
            <input [(ngModel)]="itemGrilla.Descripcion" type="text" formControlName="descripcion" class="form-control"
              id="descripcion" placeholder="Descripción">
          </div>
        </div>
        <div class="form-group col text-right" style="margin-top: 25px;">
          <button type="button" class="btn btn-danger" is="btnCancelar" (click)="modal.dismiss()">Cancelar</button>
          <button type="button" class="btn btn-success" id="btnGuardar" (click)="guardar()">{{ tituloBoton }}</button>
        </div>
      </form>
    </div>
  </ng-template>

  <ng-template #contentInhabilitar let-modal>
    <div class="modal-header">
      <a>
        <img *ngIf="imgSubmenu !== undefined" class="img-crud" src="{{imgSubmenu.TipoIcono}}{{imgSubmenu.Icono}}" />
      </a>
      <a style="margin-left: 5px;"></a>
      <h4 class="modal-title">{{ tituloModal }}</h4>
    </div>
    <div class="modal-body">
      <a></a>
      <h4 class="">Desea Eliminar?</h4>
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" (click)="modal.dismiss()">Cancelar</button>
        <button type="button" class="btn btn-primary" (click)="inhabilitar()">Aceptar</button>
      </div>
    </div>
  </ng-template>

  <ng-template #contentHabilitar let-modal>
    <div class="modal-header">
      <a>
        <img *ngIf="imgSubmenu !== undefined" class="img-crud" src="{{imgSubmenu.TipoIcono}}{{imgSubmenu.Icono}}" />
      </a>
      <a style="margin-left: 5px;"></a>
      <h4 class="modal-title">{{ tituloModal }}</h4>
    </div>
    <div class="modal-body">
      <a></a>
      <h4 class="">Desea Habilitar?</h4>
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" (click)="modal.dismiss()">Cancelar</button>
        <button type="button" class="btn btn-primary" (click)="habilitar()">Aceptar</button>
      </div>
    </div>
  </ng-template>

  <footer class="footer">
    <app-footer></app-footer>
  </footer>