<app-loader [isLoading]="loading"></app-loader>
<div class="container-fluid main-section">
  <div class="modal-content">
    <!-- Filtros de Búsqueda -->
    <form [formGroup]="formFiltro">
      <div class="container">
        <h4 class="title-menu centered-rounded-background">
          <a>
            <img *ngIf="imgSubmenu !== undefined" class="img-crud" src="{{imgSubmenu.TipoIcono}}{{imgSubmenu.Icono}}" />
          </a>
          <a style="margin-left: 5px;">Clientes</a>
        </h4>
      </div>
      <div class="d-flex align-items-start justify-content-between">
        <div class="form-group col-md-2 mt-3">
          <label for="idFiltro">Filtrar Por:</label>
          <select formControlName="idFiltro" class="form-control" id="idFiltro" (change)="cambiarFiltro()">
            <option value="1">Solo Habilitados</option>
            <option value="2">Solo Inhabilitados</option>
          </select>
        </div>
        <div class="form-group mt-3">
          <button type="button" class="btn btn-primary" id="AgregarModalbtn" (click)="openAgregar(content)">
            <i class="fa-solid fa-circle-plus"></i> <!-- Aplica la clase 'button-icon' al ícono -->
            Agregar
          </button>
        </div>
      </div>
    </form>
    <!-- Grilla -->
    <!-- Grilla -->
    <div class="registros mt-3" *ngIf="listaGrilla && listaGrilla.length > 0; else noData">
      <div class="table-responsive">
        <div class="scroll-table">
          <table class="table">
            <thead class="thead-dark">
              <tr>
                <th scope="col">Nro</th>
                <th scope="col">Estado</th>
                <th scope="col">Documentacion</th>
                <th scope="col">Nombre</th>
                <th scope="col">Apellido</th>
                <th scope="col">Mail</th>
                <th scope="col">Razon Social</th>
                <th scope="col">Fecha de Nacimiento</th>
                <th scope="col">Telefono</th>
                <th scope="col">Calle</th>
                <th scope="col">Nro</th>
                <th scope="col">Piso</th>
                <th scope="col">Acción</th>
              </tr>
            </thead>
            <tbody class="tablaUser">
              <tr
                *ngFor="let item of listaGrilla | paginate: { itemsPerPage: 10, currentPage: paginaActual }; let i = index">
                <td scope="col">{{ item.IdCliente }}</td>
                <td scope="col">{{ item.FechaBaja === null ? 'Activo' : 'No Activo' }}</td>
                <td scope="col">{{ item.Documentacion }}</td>
                <td scope="col">{{ item.Nombre }}</td>
                <td scope="col">{{ item.Apellido }}</td>
                <td scope="col">{{ item.Mail }}</td>
                <td scope="col">{{ item.RazonSocial }}</td>
                <td scope="col">{{ item.FechaNacimiento }}</td>
                <td scope="col">{{ item.Telefono }}</td>
                <td scope="col">{{ item.Calle }}</td>
                <td scope="col">{{ item.Nro }}</td>
                <td scope="col">{{ item.Piso }}</td>
                <td scope="col" class="dropdown">
                  <!-- Botón de acción con menú desplegable -->
                  <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton"
                    data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="fa-solid fa-gears"></i>
                  </button>
                  <!-- Menú desplegable con opciones -->
                  <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                    <!-- Mostrar solo si FechaBaja no es null -->
                    <li *ngIf="item.FechaBaja !== null">
                      <a class="dropdown-item" (click)="openHabilitar(contentHabilitar, item)">
                        <i class="fa-solid fa-check"></i> Habilitar
                      </a>
                    </li>
                    <!-- Mostrar solo si FechaBaja es null -->
                    <li *ngIf="item.FechaBaja === null">
                      <a class="dropdown-item" (click)="openInhabilitar(contentInhabilitar, item)">
                        <i class="fa-solid fa-xmark"></i> Inhabilitar
                      </a>
                    </li>
                    <!-- Mostrar solo si FechaBaja es null -->
                    <li *ngIf="item.FechaBaja === null">
                      <a class="dropdown-item" (click)="openEditar(content, item)">
                        <i class="fa-solid fa-pen-to-square"></i> Editar
                      </a>
                    </li>
                  </ul>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
    <div class="mt-3"></div>
    <pagination-controls (pageChange)="cambiarPagina($event)" class="my-pagination" previousLabel="Anterior"
      nextLabel="Siguiente"></pagination-controls>
    <ng-template #noData>
      <h5>No se encontraron registros...</h5>
    </ng-template>
  </div>
</div>
<!-- AgregarClienteModal -->
<ng-template #content let-modal>
  <div class="modal-header">
    <a>
      <img *ngIf="imgSubmenu !== undefined" class="img-crud" src="{{imgSubmenu.TipoIcono}}{{imgSubmenu.Icono}}" />
    </a>
    <a style="margin-left: 5px;"></a>
    <h4 class="modal-title">{{ tituloModal }}</h4>
  </div>
  <div class="modal-body">
    <form [formGroup]="formItemGrilla">
      <div class="row">
        <div class="form-group col-md-4">
          <div style="margin-bottom: 15px;">
            <label for="tipoPersona">Tipo de Persona:</label>
          </div>
          <select [(ngModel)]="itemGrilla.IdTipoPersona" formControlName="tipoPersona" class="form-control"
          [ngClass]="{'is-invalid': isFieldInvalid('tipoPersona'), 'is-valid': !isFieldInvalid('tipoPersona') && isFieldTouched('tipoPersona')}">
            <option [value]="undefined" disabled>Seleccione...</option>
            <option *ngFor="let persona of lTipoPersona" [value]="persona.IdTipoPersona"> {{persona.Descripcion }}
            </option>
          </select>
          <div *ngIf="isFieldInvalid('tipoPersona')" class="invalid-feedback">
            {{ getErrorMessage('tipoPersona') }}
          </div>
        </div>
        <div class="form-group col-md-4">
          <div style="margin-bottom: 15px;">
            <label for="TipoDomicilio" disabled>Tipo de Domicilio:</label>
          </div>
          <select [(ngModel)]="itemGrilla.IdTipoDomicilio" formControlName="TipoDomicilio" class="form-control"
          [ngClass]="{'is-invalid': isFieldInvalid('TipoDomicilio'), 'is-valid': !isFieldInvalid('TipoDomicilio') && isFieldTouched('TipoDomicilio')}">
            <option [value]="undefined">Seleccione...</option>
            <option *ngFor="let domicilio of lTipoDomicilio" [value]="domicilio.IdTipoDomicilio">
              {{domicilio.Descripcion }}</option>
          </select>
          <div *ngIf="isFieldInvalid('TipoDomicilio')" class="invalid-feedback">
            {{ getErrorMessage('TipoDomicilio') }}
          </div>
        </div>
        <div class="form-group col-md-4">
          <div style="margin-bottom: 15px;">
            <label for="Calle">Calle:</label>
          </div>
          <input [(ngModel)]="itemGrilla.Calle" type="text" formControlName="Calle" class="form-control" id="Calle"
            placeholder="Calle" [ngClass]="{'is-invalid': isFieldInvalid('Calle'), 'is-valid': !isFieldInvalid('Calle') && isFieldTouched('Calle')}">
          <div *ngIf="isFieldInvalid('Calle')" class="invalid-feedback">
            {{ getErrorMessage('Calle') }}
          </div>
        </div>
        <div class="row">
          <div class="form-group col-md-4">
            <div style="margin-bottom: 15px;">
              <label for="Nro">Nro:</label>
            </div>
            <input [(ngModel)]="itemGrilla.Nro" type="text" formControlName="Nro" class="form-control" id="Nro"
              placeholder="Nro" [ngClass]="{'is-invalid': isFieldInvalid('Nro'), 'is-valid': !isFieldInvalid('Nro') && isFieldTouched('Nro')}">
            <div *ngIf="isFieldInvalid('Nro')" class="invalid-feedback">
              {{ getErrorMessage('Nro') }}
            </div>
          </div>
          <div class="form-group col-md-4">
            <div style="margin-bottom: 15px;">
              <label for="Piso">Piso:</label>
            </div>
            <input [(ngModel)]="itemGrilla.Piso" type="text" formControlName="Piso" class="form-control" id="Piso"
              placeholder="Piso" [ngClass]="{'is-invalid': isFieldInvalid('Piso'), 'is-valid': !isFieldInvalid('Piso') && isFieldTouched('Piso')}">
            <div *ngIf="isFieldInvalid('Piso')" class="invalid-feedback">
              {{ getErrorMessage('Piso') }}
            </div>
          </div>
          <div class="form-group col-md-4">
            <div style="margin-bottom: 15px;">
              <label for="TipoDocumentacion">Tipo de Documentacion:</label>
            </div>
            <select [(ngModel)]="itemGrilla.IdTipoDocumentacion" formControlName="TipoDocumentacion"
              class="form-control" [ngClass]="{'is-invalid': isFieldInvalid('TipoDocumentacion'), 'is-valid': !isFieldInvalid('TipoDocumentacion') && isFieldTouched('TipoDocumentacion')}">
              <option [value]="undefined" disabled>Seleccione...</option>
              <option *ngFor="let documentacion of lTipoDocumentacion" [value]="documentacion.IdTipoDocumentacion">
                {{documentacion.Descripcion }}</option>
            </select>
            <div *ngIf="isFieldInvalid('TipoDocumentacion')" class="invalid-feedback">
              {{ getErrorMessage('TipoDocumentacion') }}
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="form-group col-md-4">
          <div style="margin-bottom: 15px;">
            <label for="Documentacion">Documentacion:</label>
          </div>
          <input [(ngModel)]="itemGrilla.Documentacion" type="text" formControlName="Documentacion" class="form-control"
            id="Documentacion" placeholder="Documentacion" [ngClass]="{'is-invalid': isFieldInvalid('Documentacion'), 'is-valid': !isFieldInvalid('Documentacion') && isFieldTouched('Documentacion')}">
          <div *ngIf="isFieldInvalid('Documentacion')" class="invalid-feedback">
            {{ getErrorMessage('Documentacion') }}
          </div>
        </div>
        <div class="form-group col-md-4">
          <div style="margin-bottom: 15px;">
            <label for="Nombre">Nombre:</label>
          </div>
          <input [(ngModel)]="itemGrilla.Nombre" type="text" formControlName="Nombre" class="form-control" id="Nombre"
            placeholder="Nombre" [ngClass]="{'is-invalid': isFieldInvalid('Nombre'), 'is-valid': !isFieldInvalid('Nombre') && isFieldTouched('Nombre')}">
          <div *ngIf="isFieldInvalid('Nombre')" class="invalid-feedback">
            {{ getErrorMessage('Nombre') }}
          </div>
        </div>
        <div class="form-group col-md-4">
          <div style="margin-bottom: 15px;">
            <label for="Apellido">Apellido:</label>
          </div>
          <input [(ngModel)]="itemGrilla.Apellido" type="text" formControlName="Apellido" class="form-control"
            id="Apellido" placeholder="Apellido" [ngClass]="{'is-invalid': isFieldInvalid('Apellido'), 'is-valid': !isFieldInvalid('Apellido') && isFieldTouched('Apellido')}">
          <div *ngIf="isFieldInvalid('Apellido')" class="invalid-feedback">
            {{ getErrorMessage('Apellido') }}
          </div>
        </div>
      </div>
      <div class="row">
        <div class="form-group col-md-4">
          <div style="margin-bottom: 15px;">
            <label for="Mail">Mail:</label>
          </div>
          <input [(ngModel)]="itemGrilla.Mail" type="text" formControlName="Mail" class="form-control" id="Mail"
            placeholder="Mail" [ngClass]="{'is-invalid': isFieldInvalid('Mail'), 'is-valid': !isFieldInvalid('Mail') && isFieldTouched('Mail')}">
          <div *ngIf="isFieldInvalid('Mail')" class="invalid-feedback">
            {{ getErrorMessage('Mail') }}
          </div>
        </div>
        <div class="form-group col-md-4">
          <div style="margin-bottom: 15px;">
            <label for="RazonSocial">Razon Social:</label>
          </div>
          <input [(ngModel)]="itemGrilla.RazonSocial" type="text" formControlName="RazonSocial" class="form-control"
            id="RazonSocial" placeholder="Razon Social" [ngClass]="{'is-invalid': isFieldInvalid('RazonSocial'), 'is-valid': !isFieldInvalid('RazonSocial') && isFieldTouched('RazonSocial')}">
          <div *ngIf="isFieldInvalid('RazonSocial')" class="invalid-feedback">
            {{ getErrorMessage('RazonSocial') }}
          </div>
        </div>
        <div class="form-group col-md-4">
          <div style="margin-bottom: 15px;">
            <label for="FechaNacimiento">Fecha de Nacimiento:</label>
          </div>
          <input [(ngModel)]="itemGrilla.FechaNacimiento" type="date" formControlName="FechaNacimiento"
            class="form-control" id="FechaNacimiento" placeholder="Fecha de Nacimiento" 
            [ngClass]="{'is-invalid': isFieldInvalid('FechaNacimiento'), 'is-valid': !isFieldInvalid('FechaNacimiento') && isFieldTouched('FechaNacimiento')}">
          <div *ngIf="isFieldInvalid('FechaNacimiento')" class="invalid-feedback">
            {{ getErrorMessage('FechaNacimiento') }}
          </div>
        </div>
      </div>
      <div class="row">
        <div class="form-group col-md-4">
          <div style="margin-bottom: 15px;">
            <label for="Telefono">Telefono:</label>
          </div>
          <input [(ngModel)]="itemGrilla.Telefono" type="text" formControlName="Telefono" class="form-control"
            id="Telefono" placeholder="Telefono" [ngClass]="{'is-invalid': isFieldInvalid('Telefono'), 'is-valid': !isFieldInvalid('Telefono') && isFieldTouched('Telefono')}">
          <div *ngIf="isFieldInvalid('Telefono')" class="invalid-feedback">
            {{ getErrorMessage('Telefono') }}
          </div>
        </div>
        <div class="form-group col-md-4">
          <div style="margin-bottom: 15px;">
            <label for="Provincia">Provincia:</label>
          </div>
          <select [(ngModel)]="itemGrilla.IdProvincia" formControlName="Provincia" class="form-control"
          [ngClass]="{'is-invalid': isFieldInvalid('Provincia'), 'is-valid': !isFieldInvalid('Provincia') && isFieldTouched('Provincia')}"
          (change)="obtenerLocalidadesPorProv(itemGrilla.IdProvincia)">
            <option [value]="undefined" disabled>Seleccione...</option>
            <option *ngFor="let Provincia of lprovincia" [value]="Provincia.IdProvincia"> {{Provincia.Detalle }}
            </option>
          </select>
          <div *ngIf="isFieldInvalid('Provincia')" class="invalid-feedback">
            {{ getErrorMessage('Provincia') }}
          </div>
        </div>
        <div class="form-group col-md-4">
          <div style="margin-bottom: 15px;">
            <label for="Localidad">Localidad:</label>
          </div>
          <select [(ngModel)]="itemGrilla.IdLocalidad" formControlName="Localidad" class="form-control"
          [ngClass]="{'is-invalid': isFieldInvalid('Localidad'), 'is-valid': !isFieldInvalid('Localidad') && isFieldTouched('Localidad')}">
            <option [value]="undefined" disabled>Seleccione...</option>
            <option *ngFor="let Localidad of llocalidad" [value]="Localidad.IdLocalidad"> {{Localidad.Detalle }}
            </option>
          </select>
          <div *ngIf="isFieldInvalid('Localidad')" class="invalid-feedback">
            {{ getErrorMessage('Localidad') }}
          </div>
        </div>
      </div>
      <div class="form-group col text-right" style="margin-top: 25px;">
        <button type="button" class="btn btn-danger" is="btnCancelar" (click)="cerrarModal()">Cancelar</button>
        <button type="button" class="btn btn-success" id="btnGuardar" (click)="guardar()">{{ tituloBoton }}</button>
      </div>
    </form>
  </div>
</ng-template>

<ng-template #contentInhabilitar let-modal>
  <div class="modal-header">
    <a></a>
    <h4 class="modal-title">{{ tituloModal }}</h4>
  </div>
  <div class="modal-body">
    <a></a>
    <h4 class="">Desea Eliminar?</h4>
    <div class="modal-footer">
      <button type="button" class="btn btn-danger" (click)="modal.dismiss()">Cancelar</button>
      <button type="button" class="btn btn-primary" (click)="inhabilitar()">Aceptar</button>
    </div>
  </div>
</ng-template>

<ng-template #contentHabilitar let-modal>
  <div class="modal-header">
    <a></a>
    <h4 class="modal-title">{{ tituloModal }}</h4>
  </div>
  <div class="modal-body">
    <a></a>
    <h4 class="">Desea Habilitar?</h4>
    <div class="modal-footer">
      <button type="button" class="btn btn-danger" (click)="modal.dismiss()">Cancelar</button>
      <button type="button" class="btn btn-primary" (click)="habilitar()">Aceptar</button>
    </div>
  </div>
</ng-template>

<footer class="footer">
  <app-footer></app-footer>
</footer>